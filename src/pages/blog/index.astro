---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SEO from '../../components/SEO.astro';
import { getCollection } from 'astro:content';
const allPosts = await getCollection('posts');
const posts = allPosts.filter(p => new Date(p.data.publishDate) <= new Date()).sort((a,b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());
const categories = [...new Set(posts.map(p => p.data.category))];
---
<BaseLayout><SEO slot="head" title="Image Blog" description="Guides on image optimization, formats, and tools." />
  <div class="max-w-4xl mx-auto px-4 py-10">
    <header class="mb-10"><h1 class="text-3xl font-bold text-gray-900">üñºÔ∏è Image Blog</h1><p class="text-gray-600 mt-2">Tips and guides for working with images.</p></header>
    <div class="flex flex-wrap gap-2 mb-8" id="cf">
      <button data-category="all" class="px-3 py-1 bg-primary-600 text-white text-sm rounded-full font-medium">All</button>
      {categories.map(cat => (<button data-category={cat} class="px-3 py-1 bg-gray-100 text-gray-600 text-sm rounded-full hover:bg-gray-200 cursor-pointer">{cat}</button>))}
    </div>
    <div class="space-y-6" id="pl">
      {posts.map(post => (
        <a href={`/blog/${post.id}/`} data-post-category={post.data.category} class="block bg-white rounded-xl border border-gray-100 p-6 hover:shadow-md hover:border-purple-200 transition-all group">
          <div class="flex items-center gap-3 mb-2"><span class="px-2 py-0.5 bg-purple-50 text-purple-700 text-xs font-medium rounded-full uppercase">{post.data.category}</span><time datetime={post.data.publishDate} class="text-xs text-gray-400">{new Date(post.data.publishDate).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'})}</time></div>
          <h2 class="text-xl font-semibold text-gray-900 group-hover:text-purple-600">{post.data.title}</h2>
          <p class="text-gray-600 mt-2 text-sm line-clamp-2">{post.data.description}</p>
        </a>
      ))}
    </div>
    <script is:inline>document.getElementById('cf').addEventListener('click',e=>{const b=e.target.closest('button');if(!b)return;const c=b.dataset.category;document.querySelectorAll('#cf button').forEach(x=>{x.classList.remove('bg-primary-600','text-white');x.classList.add('bg-gray-100','text-gray-600')});b.classList.remove('bg-gray-100','text-gray-600');b.classList.add('bg-primary-600','text-white');document.querySelectorAll('#pl > a').forEach(p=>{p.style.display=(c==='all'||p.dataset.postCategory===c)?'':'none'})});</script>
  </div>
</BaseLayout>
